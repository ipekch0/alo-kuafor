// AloKuaför - Premium Hair Salon Marketplace
// Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// AUTHENTICATION & USERS
// ============================================

model User {
  id              Int              @id @default(autoincrement())
  email           String           @unique
  password        String
  name            String
  role            String           @default("customer") // admin, salon_owner, professional, customer
  phone           String?
  avatar          String?
  
  // Relations
  ownedSalons     Salon[]          @relation("SalonOwner")
  professionalProfile Professional?
  appointments    Appointment[]    @relation("UserAppointments")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ============================================
// SALON & PROFESSIONALS
// ============================================

model Salon {
  id              Int              @id @default(autoincrement())
  name            String
  slug            String           @unique // for url friendly names
  description     String?
  address         String
  city            String
  district        String?
  phone           String
  email           String?
  image           String?          // Main cover image
  images          String?          // JSON array of additional images
  rating          Float            @default(0)
  reviewCount     Int              @default(0)
  isContracted    Boolean          @default(false) // "Anlaşmalı" status
  
  ownerId         Int
  owner           User             @relation("SalonOwner", fields: [ownerId], references: [id])
  
  professionals   Professional[]
  services        Service[]
  appointments    Appointment[]
  
  workingHours    String?          // JSON object: { "monday": { "start": "09:00", "end": "19:00" }, ... }
  
  // Official Business Details
  taxNumber       String?
  taxOffice       String?
  isVerified      Boolean          @default(false)
  ownerName       String?          // Official business owner name

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model Professional {
  id              Int              @id @default(autoincrement())
  userId          Int?             @unique // Optional link to a User account
  user            User?            @relation(fields: [userId], references: [id])
  
  salonId         Int
  salon           Salon            @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  name            String
  title           String           // "Senior Stylist", "Colorist", etc.
  bio             String?
  photo           String?
  specialties     String?          // JSON array: ["Kesim", "Boya"]
  
  appointments    Appointment[]
  workingHours    String?          // JSON object: specific hours for this pro
  
  active          Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

// ============================================
// SERVICES
// ============================================

model Service {
  id              Int              @id @default(autoincrement())
  salonId         Int
  salon           Salon            @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  name            String           // "Saç Kesimi", "Gelin Başı"
  category        String           // "hair", "makeup", "skincare", "nails"
  description     String?
  duration        Int              // Minutes
  price           Decimal          // Price in TL
  currency        String           @default("TRY")
  
  active          Boolean          @default(true)
  appointments    Appointment[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

// ============================================
// APPOINTMENTS & CUSTOMERS
// ============================================

model Customer {
  id              Int              @id @default(autoincrement())
  name            String
  phone           String           @unique
  email           String?
  notes           String?
  
  appointments    Appointment[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model Appointment {
  id              Int              @id @default(autoincrement())
  
  // The user who booked (if registered)
  userId          Int?
  user            User?            @relation("UserAppointments", fields: [userId], references: [id])
  
  // The customer details (if guest or for record keeping)
  customerId      Int?
  customer        Customer?        @relation(fields: [customerId], references: [id])
  
  salonId         Int
  salon           Salon            @relation(fields: [salonId], references: [id])
  
  professionalId  Int
  professional    Professional     @relation(fields: [professionalId], references: [id])
  
  serviceId       Int
  service         Service          @relation(fields: [serviceId], references: [id])
  
  dateTime        DateTime
  status          String           @default("pending") // pending, confirmed, completed, cancelled, no_show
  
  notes           String?
  totalPrice      Decimal
  
  // Payment Info
  isPaid          Boolean          @default(false)
  paymentMethod   String?          // credit_card, cash, transfer

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}
